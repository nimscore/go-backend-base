syntax = "proto3";
package proto;
option go_package = "/proto";

import "entity.proto";

import "google/api/annotations.proto";

// ============================================================================
// Create (FR-335-344)
// ============================================================================

message CreateRequest {
  string post_id                    = 1;
  string text                       = 2;  // 1-10000 chars
  optional string parent_comment_id = 3;  // for nested replies
  repeated string attachment_urls   = 4;  // S3 URLs from presigned upload
}

message CreateResponse {
  Comment comment = 1;
}

// ============================================================================
// Get (FR-216, FR-219)
// ============================================================================

message GetRequest {
  string comment_id = 1;
}

message GetResponse {
  Comment comment = 1;
}

// ============================================================================
// Update (FR-384-390)
// ============================================================================

message UpdateRequest {
  string comment_id = 1;
  string text       = 2;
}

message UpdateResponse {
  Comment comment = 1;
}

// ============================================================================
// Delete (FR-030)
// ============================================================================

message DeleteRequest {
  string comment_id = 1;
}

message DeleteResponse {
  string message = 1;
}

// ============================================================================
// Like (FR-173, FR-175, FR-177, FR-178)
// ============================================================================

message LikeRequest {
  string comment_id = 1;
}

message LikeResponse {
  string message       = 1;
  int32 new_like_count = 2;
}

// ============================================================================
// Unlike (FR-174, FR-176)
// ============================================================================

message UnlikeRequest {
  string comment_id = 1;
}

message UnlikeResponse {
  string message       = 1;
  int32 new_like_count = 2;
}

// ============================================================================
// Stream (FR-031-034, FR-081) - gRPC Server-Side Streaming
// ============================================================================

message StreamRequest {
  optional string post_id = 1;  // if empty, stream all platform comments
}

// ============================================================================
// Service Definition
// ============================================================================

service CommentService {
  // CRUD Operations
  rpc Create(CreateRequest) returns (CreateResponse) {
    option (google.api.http) = {
      post: "/comments"
      body: "*"
    };
  }

  rpc Get(GetRequest) returns (GetResponse) {
    option (google.api.http) = {
      get: "/comments/{comment_id}"
    };
  }

  rpc Update(UpdateRequest) returns (UpdateResponse) {
    option (google.api.http) = {
      patch: "/comments/{comment_id}"
      body: "*"
    };
  }

  rpc Delete(DeleteRequest) returns (DeleteResponse) {
    option (google.api.http) = {
      delete: "/comments/{comment_id}"
    };
  }

  // Like Operations
  rpc Like(LikeRequest) returns (LikeResponse) {
    option (google.api.http) = {
      post: "/comments/{comment_id}/like"
    };
  }

  rpc Unlike(UnlikeRequest) returns (UnlikeResponse) {
    option (google.api.http) = {
      delete: "/comments/{comment_id}/like"
    };
  }

  // Real-time Streaming
  rpc Stream(StreamRequest) returns (stream CommentEvent) {
    // No HTTP mapping - gRPC streaming only
  }
}
