# Техническая документация сервера

Данная документация описывает архитектуру и API сервера платформы мультиблогов на Go.

## Структура документации

### Обзор

- **[overview.md](overview.md)** - Общая архитектура, технологический стек, ключевые концепции

### Основные сервисы

#### Аутентификация и пользователи

- **[authentication.md](authentication.md)** - Регистрация, вход, JWT токены, управление сессиями
- **[users.md](users.md)** - Профили пользователей, подписки, статистика

#### Контент

- **[communities.md](communities.md)** - Создание и управление сообществами
- **[posts.md](posts.md)** - Посты, лайки, закладки, публикация
- **[comments.md](comments.md)** - Комментарии с real-time streaming, вложенность, медиа

#### Контент-дискавери

- **[feeds.md](feeds.md)** - Ленты контента (best feed, personalized feed)
- **[search.md](search.md)** - Полнотекстовый поиск по всему контенту

#### Права и модерация

- **[roles-permissions.md](roles-permissions.md)** - Система ролей и разрешений
- **[moderation.md](moderation.md)** - Баны, муты, логи модерации
- **[reports.md](reports.md)** - Система жалоб на контент
- **[badges.md](badges.md)** - Система наград (badges) для пользователей и сообществ

#### Система коммуникации

- **[notifications.md](notifications.md)** - Real-time уведомления о событиях
- **[media.md](media.md)** - Загрузка медиа файлов в S3

#### Настройки

- **[platform.md](platform.md)** - Глобальные настройки платформы, статистика

## Ключевые концепции

### gRPC Services

Система построена на 15 gRPC сервисах. Каждый файл документации описывает один или несколько связанных сервисов.

### Proto файлы

Все API определены в директории `proto/`. Документация ссылается на соответствующие proto файлы.

### Functional Requirements (FR)

В документации указаны ссылки на FR из спецификации.

### Real-time Streaming

Три сервиса используют gRPC Server-Side Streaming:

- CommentService - real-time комментарии
- PermissionService - обновления разрешений
- NotificationService - уведомления

### Cursor-based Pagination

Все списковые операции используют cursor-based пагинацию для масштабируемости.

## Технологический стек

### Протокол

- gRPC - основной протокол
- grpc-gateway - REST API proxy
- JWT - аутентификация

### Хранение

- PostgreSQL - основная БД
- PostgreSQL FTS - полнотекстовый поиск
- S3-совместимое хранилище - медиа файлы

### Безопасность

- Rate limiting (5 login/10min, 100 req/min)
- Have I Been Pwned API - проверка паролей
- Permission-based authorization

## Соглашения в документации

### Структура каждого файла

1. **Обзор** - краткое описание сервиса
2. **Сущности** - protobuf message definitions
3. **Endpoints** - детальное описание каждого RPC
4. **Бизнес-логика** - правила, ограничения, особенности
5. **Производительность** - рекомендации по оптимизации

### Формат endpoint описания

```
### MethodName

RPC: RPC_signature
HTTP: HTTP_method HTTP_path
FR: FR-XXX (ссылки на requirements)

Описание метода.

Request: protobuf definition
Response: protobuf definition

Требования:
- Список требований

Ошибки:
- Возможные ошибки
```

## Полезные ссылки

- **Proto файлы**: `proto/`
- **Реализация**: `internal/`

## Версионирование

Документация соответствует версии API, определенной в proto файлах. При изменении API обновляется соответствующая документация.

## Контрибьютинг

При добавлении нового функционала:

1. Обновите proto файл
2. Обновите соответствующий файл документации
3. Добавьте тесты и примеры использования
